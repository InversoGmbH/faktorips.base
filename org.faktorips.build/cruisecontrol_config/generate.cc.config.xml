<!-- Ausfuehren der XSL Transformation, zum Generieren der CruiseControl config.xml Datei -->
<!-- Eingabe: ./faktorips.projects.xml -->
<!-- Ausgabe: ./config.xml -->
<project name="runXslt" basedir="." default="generate.config.xml">

	<!-- Cruise Control config.xml -->

	<target name="generate.config.xml" depends="-xslt.config.xml,-config.xml.pretty.print" 
		description="generates the cc config.xml file" />
	
	<target name="-xslt.config.xml">
		<!-- xsl file is stored in the subdirectory ./xsl -->
		<xslt in="faktorips.projects.xml" out="config.xml"
		      style="xsl/createcruisecontrolconfig.xsl"
			  force="true">
		  <outputproperty name="method" value="xml"/>
		  <outputproperty name="encoding" value="UTF-8"/>
		  <outputproperty name="indent" value="yes"/>
		  <param name="usecvs" expression="true"/>
		  <param name="htmlemail" expression="true"/>
		</xslt>
	</target>
	
	<target name="-config.xml.pretty.print">
		<!-- using xmlbeans PrettyPrinter to format the generated xml file in a pretty style -->
        <ant dir=".." antfile="build.xml" target="xml.pretty.print">
            <property name="input.xml" value="${basedir}/config.xml"/>
        </ant>
        <copy file="${basedir}/config.xml_pretty" tofile="${basedir}/config.xml" overwrite="true" verbose="false"/>
		<delete file="${basedir}/config.xml_pretty" verbose="false"/>
        <echo message="config.xml successfully generated"/>
    </target>

	<!-- Ant build file to build all faktor ips plugin projects -->
	
	<target name="generate.build.all.xml" depends="-xslt.build.all.xml,-build.all.xml.pretty.print" 
		description="generates the build.all.xml ant file" />

	<target name="-xslt.build.all.xml">
		<!-- xsl file is stored in the subdirectory ./xsl -->
		<xslt in="faktorips.projects.xml" out="${basedir}/../build.all.xml"
		      style="xsl/createbuildallxml.xsl"
			  force="true">
		  <outputproperty name="method" value="xml"/>
		  <outputproperty name="encoding" value="UTF-8"/>
		  <outputproperty name="indent" value="yes"/>
		</xslt>
	</target>

	<target name="-build.all.xml.pretty.print">
		<!-- using xmlbeans PrettyPrinter to format the generated xml file in a pretty style -->
        <ant dir=".." antfile="build.xml" target="xml.pretty.print">
            <property name="input.xml" value="${basedir}/../build.all.xml"/>
        </ant>
        <copy file="${basedir}/../build.all.xml_pretty" tofile="${basedir}/../build.all.xml" overwrite="true" verbose="false"/>
		<delete file="${basedir}/../build.all.xml_pretty" verbose="false"/>
        <echo message="build.all.xml successfully generated"/>
    </target>

</project>
